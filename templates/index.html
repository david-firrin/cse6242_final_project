<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"
        integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="static/styles.css">
</head>

<body>
    <div class="header">
        <div class="banner"></div>
        <div class="title">AutoAdvisor</div>
        <div class="catchphrase">Buy smarter, not harder.</div>
        <div class="icon">
            <img src="static/images/car_icon.png" alt="car_icon">
        </div>
    </div>

    <form id="my-form" class="inputs">
        <div class="input-title">
            <h3>Please enter your car details below:</h3>
        </div>
        <div class="input-1">
            <select class="custom-select" name={{ form.car_manufacturer.name }}>
                <option selected>{{ form.car_manufacturer.label }}</option>
                {% for manufacturer in car_manufacturers %}
                <option value={{ manufacturer }}>{{ manufacturer }}</li>
                    {% endfor %}
            </select>
        </div>
        <!-- miles_10k  car_age_years  condition  title_status  fuel  type  model  manufacturer  cylinders  drive  transmission  paint_color        long        lat -->
        <div class="input-2">
            <select class="custom-select" name={{ form.car_model.name }}>
                <option selected>{{ form.car_model.label }}</option>
                {% for model in car_models %}
                <option value={{ model }}>{{ model }}</li>
                    {% endfor %}
            </select>
        </div>
        <div class="input-3">
            <select class="custom-select" name={{ form.car_type.name }}>
                <option selected>{{ form.car_type.label }}</option>
                {% for car_type in car_types %}
                <option value={{ model }}>{{ car_type }}</li>
                    {% endfor %}
            </select>
        </div>
        <div class="input-4">
            <select class="custom-select" name={{ form.car_condition.name }}>
                <option selected>Select Car Condition</option>
                <option value="new">New</option>
                <option value="like new">Like New</option>
                <option value="excellent">Excellent</option>
                <option value="good">Good</option>
                <option value="fair">Fair</option>
                <option value="salvage">Salvage</option>
            </select>
        </div>
        <div class="input-5">
            <select class="custom-select" name={{ form.car_cylinder.name }}>
                <option selected>{{ form.car_cylinder.label }}</option>
                {% for cylinder in car_cylinders %}
                <option value={{ model }}>{{ cylinder }}</li>
                    {% endfor %}
            </select>
        </div>
        <div class="input-6">
            <select class="custom-select" name={{ form.car_fuel.name }}>
                <option selected>{{ form.car_fuel.label }}</option>
                {% for fuel_type in car_fuel %}
                <option value={{ model }}>{{ fuel_type }}</li>
                    {% endfor %}
            </select>
        </div>
        <div class="input-7">
            <input name="car_value" type="number" class="form-control" placeholder="Enter Car Value">
        </div>
        <div class="input-8">
            <input name="car_year" type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
                placeholder="Enter Car Year">
        </div>
        <div class="input-9">
            <input name="car_miles" type="number" class="form-control" id="exampleInputEmail1"
                aria-describedby="emailHelp" placeholder="Enter Number of Miles">
        </div>
        <button type="submit" id="analyze-button" class="btn btn-primary btn-text" onclick="handleSubmit(event)">
            Analyze Deal
        </button>
    </form>
    <div class="analysis_container">
        <div class="model-header">
            <h2></h2>
        </div>
        <div class="car_container">
            <img src="static/images/car_figure.png" alt="car_icon">
        </div>
        <div class="actual_price">
            <span class="label">Actual Car Price</span>
            <span class="value"></span>
        </div>
        <div class="predicted_price">
            <span class="label">Predicted Car Price</span>
            <span class="value"></span>
        </div>
        <div class="car_value_assessment">
            <span class="label">Assessment</span>
            <span class="value"></span>
        </div>

        <div class="PD_model">
            <canvas id="plot_mileage_age_curve_exp"></canvas>
        </div>
        <div class="PD_model_explanation">
            <p>Plot Mileage/Age Curve Model Explanation</p>
        </div>
        <div class="residuals_model">
            <canvas id="residuals_model"></canvas>
        </div>
        <div class="residuals_model_explanation">
            <p>Residuals Model Explanation</p>
        </div>
    </div>




    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script>
        let data;
        function handleSubmit(event) {
            event.preventDefault();

            var button = document.getElementById("analyze-button");
            button.classList.add("btn-loading");
            button.disabled = true;

            var form = document.getElementById("my-form");
            var formData = new FormData(form);
            // window.onload = function () {
            //     // Remove the loading state
            //     button.classList.remove("btn-loading");
            // }


            fetch('/', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    // Handle the response from the server
                    // console.log(response.json())
                    return response.json(); // Parse the response not JSON anymore
                })
                .then(responseData => {
                    data = responseData;
                    document.querySelector('.analysis_container').style.display = 'grid';

                    // const script_1 = document.createElement('script');
                    // script_1.src = 'static/graphs/plot_mileage_age_curve_1.js';
                    // document.head.appendChild(script_1);

                    const plot_mileage_age_curve_exp = document.createElement('script');
                    plot_mileage_age_curve_exp.src = 'static/graphs/plot_mileage_age_curve_exp.js';
                    document.head.appendChild(plot_mileage_age_curve_exp);

                    const plot_residuals = document.createElement('script');
                    plot_residuals.src = 'static/graphs/plot_residuals.js';
                    document.head.appendChild(plot_residuals);

                    const analysis_functions = document.createElement('script');
                    analysis_functions.src = 'static/analysis_functions.js';
                    document.head.appendChild(analysis_functions);
                })
                .catch(error => {
                    // Handle any errors that occur
                    // ...

                    // When the async task is complete, remove the loading state
                    button.classList.remove("btn-loading");
                    button.disabled = false;
                })
                .finally(() => {
                    // When the async task is complete, remove the loading state
                    button.classList.remove("btn-loading");
                    button.disabled = false;
                    // console.log('yay')

                });
        }


    </script>



</body>

</html>